注意到一个合法的方案，我们从中截取一段，只考虑数的相对大小的话，依然是一个合法的方案。

$n = 3$ 时所有合法的方案如下：

132、213、231、312

现在考虑如何由 $n = 3$ 递推到 $n = 4$ 。

我们在 $n = 3$ 的所有合法方案前面增加一位，分别填上 $1、2、3、4$，如下所示：

1/132, 1/213，1/231，1/312

2/132, 2/213，2/231，2/312

3/132, 3/213，3/231，3/312

4/132, 4/213，4/231，4/312

这里会出现重复的数字，比如说 2/312，那么我们就讲后面的数字中大于等于 $2$ 的增加 $1$，变为 2/413，这样，就得到了 1，2，3，4 的一个排列。

现在，四个数字的合法排列我们只需从上面的 16 种方案进行筛选即可。

假设 $1 \sim i $ 进行排列，首位数字我们填的是 $j$，且首位处于高位，那么，下一位只能处于低位，因为需要小于 $j$。若首位处于低位，那么下一位只能处于高位，因此需要大于等于 $j$。

我们用 $f(i, j, 0/1)$ 表示前 $i$ 个数字，首位填 $j$，且首位处于低位（0）或高位（1）的方案数。那么

$f(i, j, 0) = f(i - 1, k, 1)$，其中 $j \le k < i$

$f(i, j, 1) = f(i-1,k,0)$，其中 $1 \le k < j$

初始条件 $f(1, 1, 0) = f(1, 1, 1) = 1$​

***

接下来，对于本题的求解，和康托展开中学习的一样，我们采用 '试填法' 确定每一位应该填的数字。

从小到大枚举第一块木板的长度，若当前木板的长度为 $h$，后面的 $n - 1$ 块构成的栅栏的方案数为 $T$。

* 若 $T < C$，则说明第一个木板的长度的长度应该更长，我们将 $C$ 减去 $T$， $h$ 增加 $1$，重复尝试新的 $h$，直到满足条件 $T \ge C$。
* 若 $T \ge C$，则说明第一块木板的长度应该为 $h$，继续尝试填下一个位置的数。


当我们确定了所有的 $k$ 个位置上的数以后，结束试填。

而对于 $T$ 的值，举个例子，$n = 7$ 的时候，我们前几位已经确定了为 $523$，剩下的未填数字为 $1467$，注意到 $3、1、4、6、7$ 的相对大小为 $2,1,3,4,5$，该问题对应的合法方案等价于前 $5$ 个数字，首位为 $2$, 且处于高位的方案数。