首先，考虑问题什么时候一种方案都不存在。当我们把所有的小球拍好，最后一个位置需满足 $w_i \le b_i + k$。即 $n \le m + k$，所以 $k < n - m$ 的时候方案数为 $0$。反之至少有一种方案，我们可以把黑球全放前面，白球全放后面即可满足题目要求。

另外，若 $k \ge n$ ,此时无论黑白球如何排列，均满足条件。

为了方便，下面的讨论我们假设 $n - m \le k < n$

现在，在满足 $n \le m + k$ 的前提下，我们考虑在所有的排列中，不合法方案的数量。因为方案不合法，那么一定存在某些位置  ，满足 白球之和大于黑球之和加上 $k$，记这样的位置中最先出现的为位置 $i$。

如下图所示

![image-20240120131726841](C:\Users\Lee\OneDrive\笔记\算法学习\题解\assets\image-20240120131726841.png)

位置 $i$ 是第一个满足 $w_i>b_i+k$ 的位置，也就是说，第 $i$ 个位置一定是 w，前面 w 的数量之和一定等于 b 的数量之和加上 $k$。这里，假设 w 的数量为 $x$，其余各位置球的数量如上图所示。 

现在，我们将第 $i$ 个位置之后的白球变为黑球，黑球变为白球。

![image-20240120132227195](C:\Users\Lee\OneDrive\笔记\算法学习\题解\assets\image-20240120132227195.png)

这样，一共有 $m + k + 1$ 个白球，$n - (k + 1)$ 个黑球。

上面的变化给出了一个结论：

任意一种非法的方案对应了一种 $m + k + 1$ 个白球，$n - (k + 1)$ 个黑球的排列方案，非法方案不同，对应的方案也不同，即非法方案的数量 $\le C_{n+m}^{m + k + 1}$。

接下来，我们将证明任意一种 $m + k + 1$ 个白球，$n - (k + 1)$ 个黑球的排列方案，都已唯一的非法的方案与之对应。

用 $t$ 表示到当前位置为止，白球减去黑球的数量，在最开始的时候，$t$ 的值为 $0$，最终，$t$ 变为了 $m - n + 2(k + 1)$。注意到我们讨论的条件，$m - n \ge -k$。所以 $t$ 最后的值大于等于 $k + 2$。

注意到在依次计算 $t$ 的值的过程中，$t$ 的值要么增加 $1$，要么减少 $1$，而 $t$ 的值从 $0$ 最终变为一个大于等于 $k+2$ 的值。那么，必然存在一个最早出现的位置，在该位置 $t$ 的值为 $k + 1$。记该位置为 $i$。我们把上面的图重新放在这里，因为此时我们面临的情况完全一致，位置 $i$ 一定是白球，位置 $i - 1$ 处一定满足白球比黑球恰好多 $k$ 个。

![image-20240120132227195](C:\Users\Lee\OneDrive\笔记\算法学习\题解\assets\image-20240120132227195.png)

和前面类似的步骤，我们再将位置 $i$ 之后的白球变为黑球，黑球变为白球，这样便可以证明我们的结论。