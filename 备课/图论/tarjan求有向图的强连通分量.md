### 概念

#### 流图

给定有向图 $G=(V, E)$，若存在点 $r \in V$，满足从 $r$ 出发能够到达 $V$ 中所有的点，则称 $G$ 是一个 **流图**。

#### 搜索树

在流图 $(G, r)$ 上从 $r$ 出发进行深度优先遍历，每个点只访问一次，所有发生递归的边 $(x,y)$ 构成一棵以 $r$ 为根的树，我们把它称为 **流图** $(G, r)$ **的搜索树**。

#### 时间戳

在 DFS 中，按照每个节点第一次被访问的时间顺序，依次给予流图中 $N$ 个节点 $1 \sim N$ 的整数标记，该标记被称为 **时间戳**，$x$ 的时间戳记为 $dfn(x)$。

#### 边的分类

* 树枝边
* 前向边
* 后向边
* 横叉边

#### 强连通图

给定一张有向图，若对于图中任意两个节点 $x$ 和 $y$，既存在从 $x$ 到 $y$ 的路径，也存在从 $y$ 到 $x$ 的路径，则称该有向图是 “强连通图”。

#### 强连通分量（SCC）

有向图的极大强连通子图被称为 "强连通分量"。

 ### Tarjan 算法

由强连通分量的定义，我们知道一个强连通分量的所有节点存在于搜索树的同一棵子树上，故我们只需检查子树上哪些节点可以构成一个极大强连通子图。

具体来说：

Tarjan 算法在 DFS 时同时维护一个栈，当访问到节点 $x$ 的时候，栈中保存以下两类节点：

* 搜索树上 $x$ 的祖先节点，记为集合 $anc(x)$

  记 $y \in anc(x)$。若存在后向边 $(x, y)$，则 $(x, y)$ 与 $y$ 到 $x$ 的路径一起形成环。

* 已经访问过，并且存在一条路径到达 $arc(x)$ 的节点。

  设 $z$ 是这样一个节点，从 $z$ 出发存在一条路径到达 $y \in arc(x)$。若存在横叉边 $(x, z)$，则 $(x,z)$，$z$ 到 $y$ 的路径，$y$ 到 $x$ 的路径形成一个环。

#### 追溯值

设 $subtree(x)$ 表示流图的搜索树中以 $x$ 为根的子树。$x$ 的追溯值 $low[x]$ 定义为满足以下条件的节点的最小时间戳：

1. 该点在栈中。
2. 存在一条从 $substree(x)$ 出发的有向边，以该点为终点。

#### 追溯值的计算方式

1. 节点 $x$ 第一次被访问时，把 $x$ 入栈，初始化 $low[x] = dfn[x]$。
2. 扫描从 $x$ 出发的每条边 $(x, y)$。
   * 若 $y$ 没被访问过，则说明 $(x, y)$ 是树枝边，递归访问 $y$，从 $y$ 回溯之后，令 $low[x]=min(low[x], low[y])$。
   * 若 $y$ 被访问过并且 $y$ 在栈中，则令 $low[x]=min(low[x], dfn[y])$​
3. 从 $x$ 回溯之前，判断是否有 $low[x] = dfn[x]$。若成立，则不断从栈中弹出节点，直到 $x$ 出栈。

#### 强连通分量的判定法则

在追溯值的计算过程中，若从 $x$ 回溯之前，有 $low[x] == dfn[x]$ 成立，则栈中从 $x$ 到栈顶的所有节点构成一个强连通分量。





