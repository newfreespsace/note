从左上角，没有限制的话，移动到右下角，向右一共移动 $W - 1$ 次，向下一共移动 $H - 1$ 次，总共的路线为 $C_{W - 1 + H - 1}^{W - 1}$。

将不合法的路线按照经过的第一个黑色格子是哪一个黑色格子进行分类，现在我们求经过的第一个黑色格子为第 $i$ 个黑色格子的路线数量，这样的路线可以分为两段，首先，从左上角移动到第 $i$ 个黑色格子，且途中不经过其他黑色格子，再从该格子移动到右下角。用 $f[i]$ 表示第一段的方案数。那么，经过的第一个黑色为第 $i$ 个黑色格子的路线数量为 $f[i] \times C_{H - x_i + W - y_i}^{H - x_i}$。

现在的问题是如何求出 $f[i]$。注意到该问题和原问题只有规模不一样，我们只需用从起点移到 $i$ 的总路线数量减去途中经过其他黑色点的路线数量即可。注意要计算 $f[i]$，需要先计算从起点到 $i$ 可能经过的其他黑色点对应的 $f$ 值。所以，我们将黑色格子按照行 $x$ 为第一关键字，列 $y$ 为第二关键字，从小到大进行排序，求解 $f[i]$ 的时候，按照 $i$ 从小到大的顺序进行求解。这样就可以保证求解 $f[i]$ 的时候，可能用到的值都已求解过。

最后，为了简化代码，可以认为左上角的起点为第 $0$ 个黑色格子，右下角的目标点为第 $n + 1$ 个黑子格子。

初始条件 $f[0] = 1$，目标为 $f[n + 1]$ 。

转移方程为 $$f[i] = C_{x_i - 1 + y_i - 1}^{x_i - 1} - \sum_{j=0}^{i - 1} \times C_{x_i - x_j + y_i - y_j}^{x_i-x_j}$$。

