---
title: 3.埃氏筛法
updated: 2022-09-22 00:51:39Z
created: 2019-07-05 06:06:20Z
---

####3. Eratosthenes筛法(埃氏筛法)
>基本思想
>对于不超过 $n$ 的每个非负整数 $p$，删除 $2p,3p,4p,...,$ 当处理完所有数之后，还没有被删除的就是素数。如果用 $vis[i]$ 表示 $i$ 已被删除。

>



```c++
memset(vis, 0, sizeof(vis));
for (int i = 2; i <= n; i++)
    for (int j = i * 2; j <= n; j += i)
        vis[j] = 1;
```
复杂度分析
给定外层循环变量 $i$ ，内存循环的次数是$\lfloor \frac n i \rfloor - 1 < \frac n i$。这样，循环的总次数小于
$$1 + \frac 1 2 + \frac 1 3 + ... + \frac 1 n = ln(n+1)+\gamma$$
其中欧拉常数$\gamma=0.577218.$
所以上述算法的时间复杂度为$O(n\log n)$.


#####埃氏筛法
在“对于不超过 $n$ 的每个非负整数 $p$ ”中，$p$ 可以限定为素数。
```c++
int m = sqrt(n + 0.5);
memset(vis, 0, sizeof(vis));
for (int i = 2; i <= m; i++)
{
    if (!vis[i])
    {
        for (int j = i * i; j <= n; j += i)
            vis[j] = 1;
    }
}
```

循环次数统计如下
|n|实现1|除以nlgn|实现2|除以nlgn|
|:---|:---|:---|:---|:---|
|    100|      283|  0.614527|      146| 0.317035|
|   1000|     5070|  0.733958|     1958| 0.283450|
|  10000|    73669|  0.799851|    23071| 0.250490|
| 100000|   966751|  0.839709|   256808| 0.223061|
|1000000|  11970035|  0.866420|  2775210| 0.200876|
|10000000|  142725365|  0.885498|  29465738| 0.182812|
|100000000|  1657511569|  0.899810|  309275826| 0.167896|

#####欧拉筛法（扩展）
>在埃氏筛法中，每个数有可能不止被筛一次，比如说6，会被2和3各筛掉一次，欧拉筛法可以保证每个数最多被筛掉一次。
>
>也就是说，关键是$\color{green}{让每个合数仅被其最小的质因数筛掉}$。

算法如下：

外循环的 $i$ 等于 $m$ 的时候
如果$m$是素数，那么我们将 $m$ 加入现有的素数表中。所以我们有从1到n的所有素数，记为$p_1,p_2,...,p_k$.
接下来，我们将$mp_1,mp_2,mp_3,...,mp_k$依次筛掉。
如果$m\%p_j==0$的话,那么退出内循环。

（为什么呢？如果$m\%p_j==0$，那么意味着$m*p_{j+1}$以及后面的数均有$p_j$这个更小的质因数，应由$p_j$筛掉。另一方面，我们也能保证每一个合数一定能被其最小的质因数筛掉）
代码如下：
```c++
bool vis[maxn]; // vis[i] = 1 表示确定i是合数
int prime[maxn];
void euler(int n)
{   memset(vis, 0, sizeof(vis));
    int cnt = 0; // 当前已经发现的素数个数
    for (int i = 2; i <= n; i++)
    {
        if(!vis[i])
            prime[++cnt] = i;
        for (int j = 1; j <= cnt; j++)
        {
            if (i * prime[j] > n)
                break;
            vis[i * prime[j]] = 1;
            if (i % prime[j] == 0)
                break;
        }
    }
}
```

#####例1.无平方因子的数
给出正整数$n$和$m$，区间$[n,m]$内的”无平方因子“的数有多少个？
整数$N$无平方因子，当且仅当不存在$k>1$，使得$N$是$k^2$的倍数。$1\leq n \leq m \leq 10^{12}$,$m-n\leq 10^7$。

分析：若存在$k>1$，使得$k^2|N$，因为一定存在素数$p|k$，所有一定存在素数$p$，满足$p^2|N$。

* 1. 生成$1$到$10^6$ 的素数表
* 2. 筛掉含有素数平方因子的数
```c++
// 其中cnt为素数表中元素个数，素数保存在prime[]中
for (int i = 1; i <= cnt; i++)
    {
        for (int j = n / prime[i] / prime[i];; j++)
        {
            if (j * prime[i] * prime[i] > m)
                break;
            vis[j * prime[i] * prime[i] - n] = 1;          
        }
    }


```
















<br> 
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<br>
<br>
<br>
<br>
<br>