---
title: 谜一样的牛
updated: 2022-10-20 02:42:42Z
created: 2022-10-20 02:17:30Z
---

我们以样例0 1 2 1 0来说明计算方法

通过尝试，可以发现应从最后一头牛往前计算。

|  当前牛   | 还可以使用的身高数字  |前面比它矮的牛的数量| 当前牛的身高|
|  ----  | ----  | ---- | ---- |
| 第 $5$ 头牛  | $1、2、3、4、5$ | $0$|$1$|
| 第 $4$ 头牛  | $2、3、4、5$ | $1$ | $3$ |
| 第 $3$ 头牛  | $2、4、5$ | $2$ | $5$ |
| 第 $2$ 头牛  | $2、4$ | $1$ | $4$ |
| 第 $1$ 头牛  | $2$ | $0$ | $2$ |

我们需要一种数据结构，支持删除一个元素，以及查找剩余元素中的第 $k$ 小元素。

在这里，我们用一个长度为 $n$ 的 $01$ 序列来表示数字的使用情况，第 $i$ 个位置是 $1$ 表示数字 $i$ 还可以选择，$0$ 表示不能选择。

现在，删除操作可以转变为将第 i 个位置的值由 1 修改为 0，查找可以转变为查找哪一个位置对应的序列前缀和恰好为 k。求该位置可以通过二分求出。我们利用树状数组即可满足这些操作。二分的时间复杂度为 $O(\log n)$，而每次查找，在树状数组中时间复杂度为 $O(\log n)$，一共 $n$ 次操作，故最终问题的时间复杂度为 $O(n\log n \log n)$。

注意到在上面的二分中，我们有浪费的操作，比如说我们需要前缀和为 $60$， 当前查找的区间为 $[1, 100]$，前缀和为 $50$， 不满足我们的要求，我们需要扩大 二分区间 $r$ 的值，比如说到了 $120$， 那么我们需要重新求区间 $[1, 120]$ 的前缀和，实际我们只需要 $[101, 120]$ 的区间和，为了解决这个问题，我们可以使用 ``倍增`` 来求前缀和恰好为 $k$ 的位置，从而将时间复杂度优化到 $O(n\log n)$。
