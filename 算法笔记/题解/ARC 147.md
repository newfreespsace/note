---
title: ARC 147
updated: 2022-09-11 09:54:41Z
created: 2022-09-11 06:52:40Z
latitude: 31.46749500
longitude: 104.67894600
altitude: 0.0000
---

## ARC 147
### A
#### 1. 简单模拟
可以通过模拟问题中的操作解决这个问题：
* 查找一个整数 $i$ 满足 $A_i = \max{\{A_1, A_2, \cdots, A_k \}}$，时间花费 $O(N)$。
* 查找一个整数 $j$ 满足 $A_i = \min{\{A_1, A_2, \cdots, A_k \}}$，且 $i \neq j$，时间花费 $O(N)$。
* 令 $A_i = A_i \bmod A_j$。如果 $A_i$ 变成了 $0$，删除它。

作为删除一个元素的替换，我们可以将其值设为一个特殊的元素，比如说 $-1$，这将花费 $O(1)$ 的时间。

时间复杂度为 $O(NX)$，其中 $X$ 为 序列 $A$ 的长度变为 $1$ 所需的操作次数，注意到将 $A$ 的长度减少 $1$ 最少需要 $1$ 次操作，故 $X \ge N$。所以该解决方案会超时。
#### 2. 分析 X
为了分析X 的值，考虑在上面的模拟中某个元素被选为 $A_i$ 的次数。当$A_i$ 被选中时，$A_i$ 会变得小于一半，因为：$\displaystyle \frac{A_i}{2} \ge A_i \bmod A_j$。


##### 证明：
求证：对正整数 $a$ 和 $b$ ($a \ge b$) 有 $\displaystyle \frac a2 \ge  a \bmod b$ 。

记 $a = bq + r$，其中 $b \ge 1, 0 \le r < b$。我们将证明 $a > 2r$。

因为 $a > 2r$  等价于 $a - r > r$ 等价于 $bq > r$。而因为 $q \ge 1$，所以 $bq \ge b > r$。所以 $a > 2r$ 成立。

故我们有 $\displaystyle \frac a2 \ge r$。

因此， A 中每一个元素作为 $A_i$ 被选出的最多次数为 $O(\log \max A)$。因此 $X$ 最多为 $O(N\log \max A)$。

#### 3. 优化模拟过程
首先，我们将 $A$ 中的元素进行排序使得 $A_1 \le A_2 \le \cdots \le A_N$。然后，我们重复如下步骤。
* 从A中选出元素 $A_k$, 其中 $k$ 为 $A$ 的长度。
* 如果 $A_k \bmod A_1 > 0$，在序列A的开始位置插入值 $A_k \bmod A_1$。
* 其他情况，删掉元素 $A_k$。

我们可以看到，在这个模拟过程中，$A1≤A2≤⋯≤Ak$ 总是成立。

通过使用双端队列，可以在 $O(1)$ 时间内完成上述所有操作。

时间复杂度为 $O(X + N\log N)$。



### B
####  1. 前言
这个问题是一个优化和建设的结合。人们可以通过逐步观察组织条件来解决它。
#### 2.尽量减少操作数A
让我们看一下 $P_i$ 的奇偶性。当 $P_i$ 和 $i$ 具有相同的奇偶性时，称 $i$ 为好索引，否则为坏索引。然后，把坏索引的数量称为P的奇偶值，并考虑它在这个过程中的变化。

在操作 $A$ 中，$P$ 的奇偶值可能增加了 $2$、$0$ 或 $-2$，这可以从下面例子的分析中可以看出。

* 如果 $i$ 和 $i+1$ 都是好索引：$P$ 的奇偶值增加 $2$ 。

* 如果 $i$ 和 $i+1$ 都是坏索引：$P$ 的奇偶值减少 $2$。

* 如果 $i$ 和 $i+1$ 中的一个是好的，另一个是坏的：$P$ 的奇偶值没有变化。

此外，在操作 $B$ 中，$P$ 的差异性并没有改变。

从这些性质和 $P$ 的理想状态（按升序排序）的奇偶值为 $0$ 的事实，我们可以看到：
* 操作A必须被执行至少 $\displaystyle \frac{1}{2} \times P$ 的初始奇偶值。

注意：可以证明，只要 $P$ 是 $(1,2,\ldots,N)$ 的一个排列，$P$ 的奇偶值一定是偶数。
#### 3. 将 P 的奇偶值变为 0
考虑如何通过执行操作 $A$ 恰好 $\displaystyle \frac{1}{2} \times P$ 次，使 $P$ 的奇偶值为 $0$。

从上面的分析来看，要做到该数量的操作 $A$，必须只对满足 $i$ 和 $i+1$ 都是坏索引的位置 $i$ 执行操作 $A$。

当好的和坏的索引按以下排列时，这就很容易做到了（ ``O`` 和 ``X`` 分别代表好的和坏的索引）。
```plain
OOXXOXXO
```

然而，在这种情况下，这有点困难。
```plain
OXOXOXOX
```

因此，让我们利用操作B可以被执行任何次数的事实，使坏的指数聚集在一起。
```plain
XXXXOOOO
```
现在，我们可以准确地执行 $\displaystyle \frac{1}{2} \times P$ 次操作 $A$ ，使 $P$ 的奇偶值将为 $0$。

注意：我们可以只执行操作 $B$，使坏索引聚集在序列末端，因为 $P$ 是 $1,2,\ldots,N$ 的一个排列，因此调整后和调整之前具有相同数量的偶数坏索引和奇数坏索引。
#### 4. 按升序对 $P$ 进行排列
因此，通过找到 $P_i>P_{i+2}$ 的 $i$，并对该 $i$ 执行操作 $B$，就可以将 $P$ 按升序排序。
#### 5. 分析操作的总数量
最后，让我们检查一下操作的总数是否最多为 $10^5$。

为了使坏索引聚集在一个末端，我们最多执行 $\displaystyle \frac{N}{4} \times \frac{N}{2}$次操作 $B$。

最多执行 $\displaystyle \frac{N}{2}$ 次操作$A$ 。

为了在最后对 $P$ 进行升序排序，我们最多执行 $\displaystyle {(\frac{N}{2})}^2$ 次操作 $B$。

对于 $N=400$，这些操作的总和为 $60200$，远小于 $10^5$。