---
title: 莫比乌斯反演
updated: 2022-09-23 08:31:16Z
created: 2022-09-22 08:07:01Z
latitude: 31.46749500
longitude: 104.67894600
altitude: 0.0000
---

## 一些概念
### 数论函数
在数论中，数论函数指定义域为正整数、陪域为复数的函数。每个数论函数都可视为复数的序列。

在数学领域中，一个函数的陪域指的是至少包含所有此函数的输出值的一个集合。

在本节， 字母 $n$ , $m$ 和 $k$ 将表示自然数，除非另有说明。
### 积性函数
一种数论函数 $f$ 被称为积性函数，如果对于任意一对 $n$ 和 $m$, $\gcd(n, m) = 1$，有$f(n\cdot m) = f(n)\cdot f(m)$，也就是说，当 $n$ 和 $m$ 是互素时，这个性质成立。

如果这个对任意 $n$ 和 $m$ 都成立，那么我们称 $f$ 为完全积性。

### 复习
前面我们学习过的约数个数函数 $d$、约数和函数 $σ$、欧拉函数均为积性函数。
[约数](/contest/18)  
[欧拉函数](/contest/242)
### 恒等函数
我们以如下方式定义恒等函数 $\text{id}$：
 $$\text{Id}(n)=n$$

### 单位函数
我们以如下方式定义单位函数 $ε$：
* $ε(n)=[n=1]$

###  除数函数
上面出现的约数个数函数、约数和函数也被称为除数函数。一般的，我们定义第 $k$ 个除数函数为
$$\sigma_k(n)=\sum_{d \mid n} d^k$$

当取 $k = 0$ 时，我们得到了约数个数函数，当取 $k = 1$ 时，我们得到了约数和函数。

### 狄利克雷卷积
如果 $f$ 和 $g$ 是数论函数，那么它们的狄利克雷卷积就是 $f * g$ 定义的数论函数：
$$(f * g)(n)=\sum_{d \mid n} f(d) g\left(\frac{n}{d}\right)$$

* 交换律：$f*g = g*f$
* 乘法结合律：$(f*g)*h = f*(g*h)$
* 分配律： $(f+g)∗h=f∗h+g∗h$
* 单位元:  $f*ε = ε*f = f$
* 逆元:  对一个非零的  $f(x)$，和另一个 $g(x)$ 满足 $f ∗ g = ε$ ，则称 $g(x)$ 为 $f(x)$ 的逆元。

对于积性函数来说，满足如下性质：
* 积性函数的逆元还是积性函数  
* 两个积性函数的狄利克雷卷积还是积性函数

### 求证 $\varphi * 1 = \text{id}$
将 $n$ 分解质因数： $n=\prod_{i=1}^k p_i^{c_i}$
首先，因为 $\varphi$ 是积性函数，故只要证明当 $n^{\prime}=p^c$ 时 $\varphi * 1=\sum_{d \mid n^{\prime}} \varphi\left(\frac{n^{\prime}}{d}\right)=\mathrm{id}$ 成立即可。
因为 $p$ 是质数，于是 $d=p^0, p^1, p^2, \cdots, p^c$
易知如下过程:
$$
\begin{aligned}
\varphi * 1 &=\sum_{d \mid n} \varphi\left(\frac{n}{d}\right) \\
&=\sum_{i=0}^c \varphi\left(p^i\right) \\
&=1+p^0 \cdot(p-1)+p^1 \cdot(p-1)+\cdots+p^{c-1} \cdot(p-1) \\
&=p^c \\
&=\mathrm{id}
\end{aligned}
$$

### 莫比乌斯函数 $μ$
定义如下：
* $μ(1)= 1$
* $μ(n) = 0$，若存在自然数 $m$，使得 $m^2|n$

对于其他情况，意味着 $n$ 可以表示为若干个不同的素数的乘积。
* $μ(n)= -1$, 有奇数个素数能整除 $n$
*  $μ(n)= 1$, 有偶数个素数能整除 $n$

我们试着求 $μ$ 的前几个值。
$μ(1)= 1$
因为 $2 = 2$，所以 $μ(2)= -1$  
因为 $3 = 3$，所以 $μ(3)= -1$  
因为 $4 = 2^2$，所以 $μ(4)= 1$  
因为 $5 = 5$，所以 $μ(5)= -1$  
因为 $6 = 2 \times 3$，所以 $μ(6)= 1$  
因为 $7 = 7$，所以 $μ(7)= -1$  
因为 $8 = 2^3$，所以 $μ(8)= 0$  
因为 $9 = 3^2$，所以 $μ(9)= 0$  
因为 $10 = 2 \times 5$，所以 $μ(10)= 1$

### 莫比乌斯函数的性质
1. 莫比乌斯函数为积性函数。
2. $\sum_{d \mid n} \mu(d)= \begin{cases}1 & n=1 \\ 0 & n \neq 1\end{cases}$

   即 $\sum_{d \mid n} \mu(d)=\varepsilon(n)$

   证明：设 $n=\prod_{i=1}^k p_i^{c i}, n^{\prime}=\prod_{i=1}^k p_i$

    那么 $\sum_{d \mid n} \mu(d)=\sum_{d \mid n^{\prime}} \mu(d)=\sum_{i=0}^k C_k^i \cdot(-1)^i=(1+(-1))^k$

    上式只在 $k = 0$，即 $n = 1$ 时值为 $1$，其余值为 $0$。

    注意上面的性质也等价于 $\mu * 1 = \varepsilon$。

### 求莫比乌斯函数
我们可以利用欧拉筛以线性时间求出莫比乌斯函数。
```c++
void getMu() {
	mu[1] = 1;
	for (int i = 2; i <= n; i++) {
		if (!flag[i]) p[++tot] = i, mu[i] = -1;
		for (int j = 1; j <= tot && i * p[j] <= n; j++) {
			flag[i * p[j]] = 1;
			if (i % p[j] == 0) {
				mu[i * p[j]] = 0;
				break;
			}
			mu[i * p[j]] = -mu[i];
		}
	}
}
```
### 莫比乌斯变换
如果有 $f(n)=\sum_{d\mid n}g(d)$，那么 $g(n)=\sum_{d\mid n}\mu(d)f(\frac{n}{d})$。
证明：由已知，$f = g * 1$，两边同时卷 $\mu$，$f * \mu = g * 1 * \mu = g * \varepsilon=g$。问题得证。

这种形式下，数论函数 $f()$ 称为数论函数 $g(n)$  的莫比乌斯变换，数论函数 $g(n)$ 称为数论函数 $f(n)$ 的莫比乌斯逆变换（反演）。


